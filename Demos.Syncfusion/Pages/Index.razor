@page "/"
@using Demos.Sf.Models
@using Demos.Sf.Services
@inject BrowserService Service

<style>
    .calendar_view {
        display: flex;
        height: 100%;
        width: 100%;
    }

    .schedule-container {
        height: calc(100vh - 116px);
    }

    .calendar_header {
        height: 60px;
        width: 100%;
    }

    .right_drawer_container {
        background-color: #F1F2F2;
        min-height: 100%;
        min-width: 279px;
        width: 279px;
    }

    .date-picker {
        width: 100%;
    }

        .date-picker .e-calendar {
            width: 100%;
            max-width: 100%;
            background: transparent;
            border: none;
        }

            .date-picker .e-calendar .e-content tr.e-month-hide,
            .e-calendar .e-content td.e-other-month > span.e-day {
                display: block;
            }

    .e-play-calendar::before {
        content: "\e322";
    }

    .holiday-cell {
        width: 100%;
        height: 100%;
        background-color: #F1F2F2;
        text-align: center;
        position: absolute;
        vertical-align: middle;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

        .holiday-cell img {
            width: 25px;
            height: 25px;
        }

        .holiday-cell .caption {
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }

    .e-schedule .e-month-view .e-work-cells {
        position: relative;
    }


    /* .e-schedule .e-outer-table > tbody > tr:first-child > td {
        border-bottom: 2px solid #5d489d;
    }*/

    .e-time-cells.e-time-slots {
        vertical-align: top;
        text-align: right !important;
        padding-right: 6px;
    }

    .e-appointment.e-lib.e-draggable {
        background: #8872fdc9 !important;
        border: unset !important;
        border-left: 6px solid #5d489d !important;
        border-radius: unset !important;
    }

    .e-schedule .e-vertical-view .e-work-cells {
        border-style: dashed !important;
    }

    .e-icons.e-icon-black-sun, .e-icons.e-icon-sun {
        text-align: left;
        padding-left: 6px;
    }

    .e-icon-down-arrow::before {
        content: '\e744';
    }

    .e-icon-black-sun::before {
        content: '\e270';
    }

    .e-icon-sun::before {
        content: '\e671';
    }

    .e-appointment {
        background: none !important;
        border: unset !important;        
        border-radius: unset !important;
        color: unset !important;
        display: flex;
        padding: 0 !important;
        margin: 0 !important;
    }

    .custom-event {
        width: 100%;
        height: 100%;
        background: #E2E6EF !important;
        border: unset !important;
        border-left: 6px solid #48629D !important;
        border-radius: unset !important;
        color: #48629D !important;
        overflow-x: hidden;
        text-overflow: ellipsis;
    }


    .astro-time {        
        background-color: antiquewhite !important;
        border-left: 6px solid #ff6a00 !important;
    }
</style>


<div class="calendar_view">
    <div class="calendar_container">
        <CalendarHeader OnViewSelected="OnCalendarViewChange"></CalendarHeader>


        <div class="schedule-container">
            <SfSchedule TValue="Appointment" WorkDays="@_workDays" AllowDragAndDrop="false" AllowResizing="false" Width="100%" Height="100%" ShowHeaderBar="false" @bind-SelectedDate="@SelectedDate" @bind-CurrentView="@CurrentView">
                <ScheduleEvents TValue="Appointment" DataBound="OnDataBound"></ScheduleEvents>
                <ScheduleWorkHours Highlight="true" Start="00:00" End="11:59"></ScheduleWorkHours>




                <ScheduleViews>
                    <ScheduleView Option="View.Day">
                        <EventTemplate>
                            @{
                                var appointment = (context as Appointment);
                                <div class="custom-event">
                                    @appointment.Subject
                                </div>
                            }
                        </EventTemplate>
                    </ScheduleView>
                    <ScheduleView Option="View.Week">
                        <EventTemplate>
                            @{
                                var appointment = (context as Appointment);
                                <div class="custom-event @(appointment.StartTime.Hour == 12 ? "astro-time" : "")">
                                    @if (appointment.StartTime.Hour == 12)
                                    {
                                        <img src="images/midday.svg" />
                                    }
                                    @appointment.Subject
                                </div>
                            }
                        </EventTemplate>
                    </ScheduleView>
                    <ScheduleView Option="View.Month" MaxEventsPerRow="5">
                        <CellTemplate Context="template">
                            @{ var holiday = GetHoliday(template.Date); }
                            @if (holiday != null)
                            {

                                <div class="holiday-cell holiday-background">
                                    <img src="images/get-together.svg" />
                                    <div class="caption">@holiday.Name</div>
                                </div>
                            }
                        </CellTemplate>
                        <EventTemplate>
                            @{
                                var appointment = (context as Appointment);
                                <MediaQuery Media="@Breakpoints.SmallDown">
                                    <Matched>
                                        <div class="event_conteiner">
                                            <div class="circle"></div>
                                            <p class="date">@appointment.StartTime.ToString("hh:mm tt")</p>
                                            <div class="subject_container">
                                                <p class="subject">@appointment.Subject</p>
                                            </div>
                                            <p class="room">Room 00</p>
                                        </div>
                                        <div>
                                            <svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M4.97317 1.11587L3.8712 0.199951L0 4.86543L3.8712 9.5309L4.97317 8.61498L1.86047 4.86543L4.97317 1.11587ZM4.42218 5.58099H5.85331V4.14986H4.42218V5.58099ZM11.5778 4.14986H10.1467V5.58099H11.5778V4.14986ZM7.28444 5.58099L8.71556 5.58099V4.14986H7.28444V5.58099ZM12.1288 0.199951L11.0268 1.11587L14.1395 4.86543L11.0268 8.61498L12.1288 9.5309L16 4.86543L12.1288 0.199951Z" fill="#15AABF" />
                                            </svg>
                                            <p class="caption">Run on Weekday</p>
                                        </div>
                                    </Matched>
                                    <Unmatched>
                                        <div class="circle"></div>
                                        <div class="subject_container">
                                            <p class="subject">@appointment.Subject</p>
                                        </div>
                                        <p class="date">@appointment.StartTime.ToString("hh:mm tt")</p>
                                    </Unmatched>
                                </MediaQuery>
                            }
                        </EventTemplate>
                    </ScheduleView>
                    <ScheduleView Option="View.MonthAgenda">
                        <EventTemplate>
                            @{
                                var appointment = (context as Appointment);

                                <div class="event_container">
                                    <div class="circle"></div>
                                    <p class="date">@appointment.StartTime.ToString("hh:mm tt")</p>
                                    <div class="subject_container">
                                        <p class="subject">@appointment.Subject</p>
                                    </div>
                                    <p class="room">Room 00</p>
                                </div>
                                <div class="event_container">
                                    <svg class="caption_icon" width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M4.97317 1.11587L3.8712 0.199951L0 4.86543L3.8712 9.5309L4.97317 8.61498L1.86047 4.86543L4.97317 1.11587ZM4.42218 5.58099H5.85331V4.14986H4.42218V5.58099ZM11.5778 4.14986H10.1467V5.58099H11.5778V4.14986ZM7.28444 5.58099L8.71556 5.58099V4.14986H7.28444V5.58099ZM12.1288 0.199951L11.0268 1.11587L14.1395 4.86543L11.0268 8.61498L12.1288 9.5309L16 4.86543L12.1288 0.199951Z" fill="#15AABF" />
                                    </svg>
                                    <p class="caption">Run on Weekday</p>
                                </div>
                            }
                        </EventTemplate>
                    </ScheduleView>
                </ScheduleViews>

                <ScheduleTimeScale Enable="true" Interval="60" SlotCount="4">
                    <MajorSlotTemplate Context="template">
                        <div>@(majorSlotTemplate(template.Date))</div>
                        @if (template.Date.Hour == 6)
                        {
                            <img src="images/sunrise.svg" />
                        }
                        else if (template.Date.Hour == 12 && template.Date.Minute == 45)
                        {
                            <img src="images/midday.svg" class="e-icons e-icon-sun" />
                        }
                        else if (template.Date.Hour == 18)
                        {
                            <img src="images/sunset.svg" class="e-icons e-icon-sun" />
                        }
                    </MajorSlotTemplate>
                </ScheduleTimeScale>

                <ScheduleEventSettings DataSource="AppointmentsData"></ScheduleEventSettings>
            </SfSchedule>
        </div>
    </div>
    <div class="right_drawer_container">
        <div class="date-picker">
            <SfCalendar TValue="DateTime" ShowTodayButton="@false" @bind-Value="@SelectedDate">
                <CalendarEvents TValue="DateTime" ValueChange="CalendarValueChanged"></CalendarEvents>
            </SfCalendar>
            <SfButton CssClass="e-flat" IsPrimary="true" IconCss="e-icons e-play-calendar" @onclick="() => SelectedDate = DateTime.Now" IconPosition="@IconPosition.Left">Today</SfButton>
        </div>
    </div>
</div>
